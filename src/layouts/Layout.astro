---
import '../styles/global.css';
import { useTranslations } from '../i118n/utils.ts';

const lang = Astro.currentLocale as 'es' | 'en' || 'es';
const t = useTranslations(lang);
const repoBase = import.meta.env.BASE_URL || '';
const currentLangPath = lang === 'es' ? repoBase : `${repoBase}en/`;
---

<!doctype html>
<html lang={lang}>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/my-portfolio/favicon.ico" />
		<meta name="generator" content={Astro.generator} />
		<title>{t('title')}</title>
		<script is:inline>
		const theme = (() => {
			if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
			return localStorage.getItem('theme');
			}
			if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
			return 'dark';
			}
			return 'light';
		})();

		if (theme === 'light') {
			document.documentElement.classList.remove('dark');
		} else {
			document.documentElement.classList.add('dark');
		}
		window.localStorage.setItem('theme', theme);
		</script>
	</head>
	
	<body>
		<header class="bg-linear-to-b from-[#aeaca8] to-(--buttercream) dark:from-[#141925] dark:to-(--deep-navy) fixed z-50 w-full p-4">
			<nav class="flex justify-between gap-4 flex-1 ">
				<ul class="flex gap-2 dark:[&>li]:hover:text-slate-50 [&>li]:hover:text-(--midnight-blue)">
					<li><a href={currentLangPath}>en</a></li>
					<p>	| </p>
					<li><a href={currentLangPath}>es</a></li>
				</ul>

				<ul class="flex gap-2 dark:[&>li]:hover:text-slate-50 [&>li]:hover:text-(--midnight-blue)">
					<li><a href={`${currentLangPath}#hero`}>{t('nav.home')}</a></li>
					<p>|</p>
					<li><a href={`${currentLangPath}#about`}>{t('nav.about')}</a></li>
					<p>|</p>
					<li><a href={`${currentLangPath}#skills`}>{t('nav.skills')}</a></li>
					<p>|</p>
					<li><a href={`${currentLangPath}#projects`}>{t('nav.projects')}</a></li>
					<p>|</p>
					<li><a href={`${currentLangPath}#contact`}>{t('nav.contact')}</a></li>
				</ul>

				<div class="inline-flex items-center gap-2">
				<div class="relative inline-block w-11 h-5">
					
					<input 
					id="theme-toggle" 
					type="checkbox" 
					class="peer appearance-none w-11 h-5 bg-slate-300 rounded-full checked:bg-slate-800 cursor-pointer transition-colors duration-300" 
					/>
					
					<label 
					for="theme-toggle" 
					class="absolute top-0 left-0 w-5 h-5 bg-white rounded-full border border-slate-300 shadow-sm transition-transform duration-300 
							peer-checked:translate-x-6 peer-checked:border-slate-800 cursor-pointer flex items-center justify-center overflow-hidden
							
							peer-checked:[&>.sun-icon]:opacity-0 peer-checked:[&>.sun-icon]:-rotate-90
							peer-checked:[&>.moon-icon]:opacity-100 peer-checked:[&>.moon-icon]:rotate-0"
					>
					
					<svg class="sun-icon w-3 h-3 text-amber-500 absolute transition-all duration-300 opacity-100 rotate-0" 
						xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41-1.41"/><path d="m19.07 4.93-1.41 1.41"/>
					</svg>

					<svg class="moon-icon w-3 h-3 text-slate-800 absolute transition-all duration-300 opacity-0 rotate-90" 
						xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
					</svg>

					</label>
				</div>
				</div>
			</nav>
		</header>
		<slot />
	</body>
</html>

<script>
  const themeSwitch = document.getElementById("theme-toggle") as HTMLInputElement;

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  };

  if (themeSwitch) {
    themeSwitch.addEventListener("change", handleToggleClick);

    if (localStorage.getItem("theme") === "dark") {
      themeSwitch.checked = true;
    }
  }
</script>
